htmx.defineExtension("safe-nonce",{transformResponse:function(e,o,n){htmx.config.refreshOnHistoryMiss=true;let t=new RegExp(`<script(\\s[^>]*>|>).*?<\\/script(\\s[^>]*>|>)`,"gis");let s=o.getResponseHeader("HX-Nonce");if(!s){const i=o.getResponseHeader("content-security-policy");if(i){const c=i.match(/(default|script)-src[^;]*'nonce-([^']*)'/i);if(c){s=c[2]}}}if(window.location.hostname){const r=new URL(o.responseURL);if(r.hostname!==window.location.hostname){s=""}}if(s){t=new RegExp(`<script(\\s(?!nonce="${s.replace(/[\\\[\]\/^*.+?$(){}'#:!=|]/g,"\\$&")}")[^>]*>|>).*?<\\/script(\\s[^>]*>|>)`,"gis")}return e.replace(t,"")},onEvent:function(e,o){if(e==="htmx:load"){console.log(o.detail.elt.outerHTML);console.log(o.detail.elt.querySelectorAll("script"));Array.from(o.detail.elt.querySelectorAll("script")).forEach(e=>{console.log(e.outerHTML);if(e.nonce!==htmx.config.inlineScriptNonce){console.log(e.outerHTML);e.remove()}})}}});